const s=`.___wpe-meta-nav{--i-bg-color: var(--bg-color, #002838);--i-height: var(--height, 40px);--i-menu-display: var(--menu-display, none);--i-padding: var(--padding, 0 20px);--i-text-color: var(--text-color, rgba(255, 255, 255, .5));--i-button-bg-color: var(--button-bg-color, #002838);--i-hover-text-color: var(--hover-text-color, #002838);--i-hover-button-bg-color: var(--hover-button-bg-color, #fff);background-color:var(--i-bg-color);padding:var(--i-padding);height:var(--i-height);display:flex;justify-content:space-between}@media screen and (min-width: 960px){.___wpe-meta-nav{--i-height: var(--height, 32px);--i-menu-display: var(--menu-display, flex);--i-padding: var(--padding, 0 80px)}}.___wpe-meta-nav__optinmonster{flex:1 0;opacity:0;transition:opacity .3s ease-in-out}.___wpe-meta-nav__optinmonster__loaded{opacity:1}.___wpe-meta-nav__menu{align-items:stretch;flex-shrink:0;opacity:0;transition:opacity .3s ease-in-out;display:var(--i-menu-display)}.___wpe-meta-nav__menu__button{display:flex;align-items:center;padding:0 16px;color:var(--i-text-color);background-color:var(--i-button-bg-color);transition:background-color .3s ease-in-out,color .3s ease-in-out}.___wpe-meta-nav__menu__button:hover,.___wpe-meta-nav__menu__button__active{color:var(--i-hover-text-color);background-color:var(--i-hover-button-bg-color)}.___wpe-meta-nav__menu__loaded{opacity:1}
`;class a extends HTMLElement{constructor(){super(...arguments),this.containerClass="___wpe-meta-nav",this.menuId="___wpe-meta-nav-menu",this.attrs={}}static get observedAttributes(){return["om-id","om-container-id","src"]}connectedCallback(){this.initMarkup(),this.loadButtons(),this.loadOptinMonster()}attributeChangedCallback(t,n,e){this.attrs[t]!==e&&(this.attrs[t]=e)}loadOptinMonster(){document.addEventListener("om.Campaign.load",()=>{const t=document.querySelector("#"+this.optinmonsterContainerId());t==null||t.classList.add(this.cn("optinmonster","loaded"))}),this.initOptinMonster(...this.optinMonsterArgs())}async loadButtons(){const t=document.querySelector("#"+this.menuId);if(!t)throw new Error("Missing menu element");await this.waitForElementVisibility(t);const n=await this.getMetaProps(...this.getterArgs()),e=document.createDocumentFragment();for(const i of n.buttons){const o=document.createElement("a");o.innerHTML=i.logo,o.href=i.link.href,i.link.rel&&(o.rel=i.link.rel),i.link.target&&(o.target=i.link.target);let r=this.cn("menu","button");new URL(i.link.href).hostname===document.location.hostname&&(r+=" "+this.cn("menu","button","active")),o.className=r,e.appendChild(o)}t.appendChild(e),t.classList.add(this.cn("menu","loaded"))}async waitForElementVisibility(t){return new Promise(n=>{new IntersectionObserver((i,o)=>{for(const r of i)if(r.isIntersecting){n(),o.disconnect();return}},{root:document.body,threshold:1}).observe(t)})}initMarkup(){this.classList.add(this.containerClass),this.innerHTML=`
        <style>${s}</style>
        <div class="${this.cn("menu")}" id="${this.menuId}"></div>
        <div class="${this.cn("optinmonster")}" id="${this.optinmonsterContainerId()}"></div>
    `}optinmonsterContainerId(){const t=this.attrs["om-container-id"];if(!t)throw new Error("Missing optinmonster container id");return t}getterArgs(){if(!this.attrs.src)throw new Error("Missing src attribute");return[this.attrs.src]}cn(...t){return[this.containerClass,...t].join("__")}async getMetaProps(t){return await(await fetch(t)).json()}optinMonsterArgs(){if(!this.attrs["om-id"])throw new Error("Missing om-id attribute");if(!/^\d+\/\d+$/.test(this.attrs["om-id"]))throw new Error("Invalid optinmonster attribute: "+this.attrs["om-id"]);const[t,n]=this.attrs["om-id"].split("/");return[t,n]}initOptinMonster(t,n){const e=document.createElement("script");e.type="text/javascript",e.src="https://a.omappapi.com/app/js/api.min.js",e.async=!0,e.dataset.user=t,e.dataset.account=n,document.getElementsByTagName("head")[0].appendChild(e)}}customElements.define("meta-nav",a);
